{% extends "base.html" %} 
{% block content %}
<div class="container">
    <h2>Input Financial Transactions</h2>
    <form id="transactionForm" method="POST">
        <div id="transactionFields">
            <div class="form-group">
                <label for="name1">Name</label>
                <input type="text" name="name[]" id="name1" required class="form-control">
            </div>
            <div class="form-group">
                <label for="amount1">Amount</label>
                <input type="number" step="0.01" name="amount[]" id="amount1" required class="form-control">
            </div>
            <div class="form-group">
                <label for="category1">Category</label>
                <select name="category[]" id="category1" required class="form-control">
                    <option value="">Select a Category</option>
                    <option value="savings">Savings</option>
                    <option value="wants">Wants</option>
                    <option value="needs">Needs</option>
                </select>
            </div>
        </div>
        <button type="button" id="addMore" class="btn btn-info">Add More</button>
        <button type="button" id="generateChart" class="btn btn-primary">Generate Chart</button>

    </form>
    <div id="piechart" style="width: 900px; height: 500px;"></div>
</div>

<script>
document.getElementById('addMore').addEventListener('click', function() {
    var container = document.getElementById('transactionFields');
    var index = container.children.length + 1; // to create unique IDs for new fields
    var newFieldGroup = document.createElement('div');
    newFieldGroup.innerHTML = `
        <div class="form-group">
            <label for="name${index}">Name</label>
            <input type="text" name="name[]" id="name${index}" required class="form-control">
        </div>
        <div class="form-group">
            <label for="amount${index}">Amount</label>
            <input type="number" step="0.01" name="amount[]" id="amount${index}" required class="form-control">
        </div>
        <div class="form-group">
            <label for="category${index}">Category</label>
            <select name="category[]" id="category${index}" required class="form-control">
                <option value="">Select a Category</option>
                <option value="savings">Savings</option>
                <option value="wants">Wants</option>
                <option value="needs">Needs</option>
            </select>
        </div>`;
    container.appendChild(newFieldGroup);
});
</script>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    function fetchChartData() {
        fetch('/expense-data')
            .then(response => response.json())
            .then(data => drawChart(data))
            .catch(error => console.error('Error fetching data:', error));
    }

    function drawChart(chartData) {
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Category');
        data.addColumn('number', 'Amount');

        var rows = chartData.map(item => [item.category, item.amount]);
        data.addRows(rows);

        var options = {'title':'Expenses Distribution by Category', 'width':900, 'height':500};

        var chart = new google.visualization.PieChart(document.getElementById('piechart'));
        chart.draw(data, options);
    }

    document.getElementById('generateChart').addEventListener('click', function() {
        fetchChartData();
    });
</script>

{% endblock %}
